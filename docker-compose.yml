version: "2"
services:
    # explorer:
    #     build: ./models
    #     volumes:
    #       - ./:/home/jovyan/work:rw
    #       - ./models/:/usr/local/lib/python3.6/site-packages/network-adequacy:ro
    #     command: bash -c "start-notebook.sh --NotebookApp.token=''"
    #     ports:
    #       - 8888:8888
    #     environment:
    #       - PYTHONPATH=/home/jovyan/work

    backend:
        build:
          context: ./web-app/backend
          dockerfile: Dockerfile
        volumes:
          - ./web-app/backend/app.py:/var/local/app.py
          - ./web-app/backend/tests:/var/local/tests:ro
          - .flake8:/var/local/.flake8:ro
          - ./web-app/backend:/usr/local/lib/python3.6/site-packages/backend
        build: ./web-app/backend
        ports:
            - 8080:5000
        command: python app.py

    mongo:
        build:
          context: ./data
          dockerfile: Dockerfile
        ports:
          - 27017:27017

    webapp:
        volumes:
          - ./web-app/frontend/src:/usr/src/app/src
          - ./web-app/frontend/public:/usr/src/app/public
        command: npm run start
        build: ./web-app/frontend
        links:
          - backend
        ports:
          - 80:3000
        depends_on:
          - mongo
          - backend
        environment:
          - REACT_APP_API_HOSTNAME=http://localhost:8080
          - REACT_APP_VERSION=DEV
